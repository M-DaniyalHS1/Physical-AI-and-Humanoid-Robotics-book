"use strict";(globalThis.webpackChunkai_textbook_frontend=globalThis.webpackChunkai_textbook_frontend||[]).push([[28],{344(e,s,t){t.r(s),t.d(s,{default:()=>a});t(6540);var n=t(1656),r=t(6123),o=t(4848);function a(){const e="undefined"!=typeof window&&localStorage.getItem("userId")||"demo-user";return(0,o.jsx)(n.A,{title:"AI Chatbot",description:"AI Chatbot for Physical AI & Humanoid Robotics Textbook",children:(0,o.jsx)("main",{children:(0,o.jsx)("section",{style:{padding:"2rem 0"},children:(0,o.jsx)("div",{className:"container",children:(0,o.jsx)("div",{className:"row",children:(0,o.jsxs)("div",{className:"col col--12",children:[(0,o.jsx)("h1",{children:"AI Textbook Assistant"}),(0,o.jsx)("p",{children:"Ask questions about Physical AI & Humanoid Robotics using our AI assistant."}),(0,o.jsx)("div",{style:{marginTop:"2rem"},children:(0,o.jsx)(r.A,{userId:e})})]})})})})})})}},6123(e,s,t){t.d(s,{A:()=>h});var n=t(6540),r=t(4335);const o=process.env.REACT_APP_API_BASE_URL||"https://your-backend-api-url/api/v1",a=r.A.create({baseURL:o,timeout:3e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{o.includes("your-")&&console.warn("API URL is not properly configured. Please set REACT_APP_API_BASE_URL in your environment.");const s=localStorage.getItem("authToken");return s&&(e.headers.Authorization=`Bearer ${s}`),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>(console.error("API request failed:",e),"ERR_NETWORK"===e.code||"ECONNABORTED"===e.code?console.error("Network error connecting to API. Check if REACT_APP_API_BASE_URL is properly configured."):401===e.response?.status&&(localStorage.removeItem("authToken"),"undefined"!=typeof window&&(window.location.href="/login")),Promise.reject(e)));const i=new class{constructor(){this.cache=new Map,this.maxSize=50,this.defaultTTL=6e5}get(e){const s=this.cache.get(e);return s?Date.now()>s.expiry?(this.cache.delete(e),null):s.value:null}set(e,s,t=this.defaultTTL){if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,{value:s,expiry:Date.now()+t})}clear(){this.cache.clear()}},c=()=>{const[e,s]=(0,n.useState)(!1),[t,r]=(0,n.useState)(null),o=(0,n.useCallback)(async(e={})=>{s(!0),r(null);try{const t=await a.post("/chat/messages",{content:"Hello, I would like to start a chat session.",selected_text:e.selectedText||null,mode:e.mode||"general"});return i.set(`session_${t.data.session_id}`,t.data),s(!1),t.data}catch(t){throw console.error("Error creating chat session:",t),r(t.message||"Error creating chat session"),s(!1),t}},[]),c=(0,n.useCallback)(async({skip:e=0,limit:t=100}={})=>{const n=`sessions_${e}_${t}`;s(!0),r(null);const o=i.get(n);if(o)return console.log("Chat sessions loaded from cache:",n),s(!1),o;try{const r={skip:e,limit:t},o=await a.get("/chat/sessions",{params:r});return i.set(n,o.data),console.log("Chat sessions loaded from API:",n),s(!1),o.data}catch(c){throw console.error("Error fetching chat sessions:",c),r(c.message||"Error fetching chat sessions"),s(!1),c}},[]),l=(0,n.useCallback)(async(e,{skip:t=0,limit:n=100}={})=>{if(!e)throw new Error("Session ID is required");const o=`messages_${e}_${t}_${n}`;s(!0),r(null);const c=i.get(o);if(c)return console.log("Chat messages loaded from cache:",o),s(!1),c;try{const r={skip:t,limit:n},c=await a.get(`/chat/sessions/${e}/messages`,{params:r});return i.set(o,c.data),console.log("Chat messages loaded from API:",o),s(!1),c.data}catch(l){throw console.error(`Error fetching messages for session ${e}:`,l),r(l.message||"Error fetching chat messages"),s(!1),l}},[]),d=(0,n.useCallback)(async(e,t)=>{if(!e)throw new Error("Session ID is required");if(!t||0===t.trim().length)throw new Error("Message content is required");s(!0),r(null);try{const n=await a.post(`/chat/sessions/${e}/messages`,{content:t});return i.clear(),s(!1),n.data}catch(n){throw console.error(`Error sending message to session ${e}:`,n),r(n.message||"Error sending message"),s(!1),n}},[]),h=(0,n.useCallback)(async e=>{if(!e)throw new Error("Session ID is required");s(!0),r(null);try{return i.clear(),s(!1),!0}catch(t){throw console.error(`Error closing session ${e}:`,t),r(t.message||"Error closing chat session"),s(!1),t}},[]),u=(0,n.useCallback)(async(e,t)=>{if(!e)throw new Error("Session ID is required");s(!0),r(null);try{const e=await a.post("/chat/messages",{content:"I want to update my chat session settings.",selected_text:t.selectedText||null,mode:t.mode||"general"});return i.set(`session_${e.data.session_id}`,e.data),s(!1),e.data}catch(n){throw console.error(`Error updating session ${e}:`,n),r(n.message||"Error updating chat session"),s(!1),n}},[]),g=(0,n.useCallback)(async e=>{if(!e)throw new Error("Session ID is required");const t=`session_${e}`;s(!0),r(null);const n=i.get(t);if(n)return console.log("Chat session loaded from cache:",t),s(!1),n;try{const n=(await c({limit:1e3})).find(s=>s.id===e);if(!n)throw new Error("Session not found");return i.set(t,n),console.log("Chat session loaded from API:",t),s(!1),n}catch(o){throw console.error(`Error fetching session ${e}:`,o),r(o.message||"Error fetching chat session"),s(!1),o}},[c]);return{createChatSession:o,getChatSessions:c,getChatSessionMessages:l,sendChatMessage:d,closeChatSession:h,updateChatSession:u,getChatSessionById:g,clearChatCache:()=>{i.clear(),console.log("Chat cache cleared")},loading:e,error:t}};var l=t(4848);const d=({userId:e,selectedText:s=null,contentId:t=null,sessionId:r,messages:o=[],onSendMessage:a,mode:i="general",loading:c=!1,error:d=null})=>{const[h,u]=(0,n.useState)(""),[g,m]=(0,n.useState)(i),x=(0,n.useRef)(null);(0,n.useEffect)(()=>{x.current&&x.current.scrollIntoView({behavior:"smooth"})},[o]);const p=e=>{if(!e)return"";return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return(0,l.jsx)("div",{className:"chat-widget",children:(0,l.jsxs)("div",{className:"chat-window",children:[(0,l.jsxs)("div",{className:"chat-header",children:[(0,l.jsx)("h3",{children:"AI Textbook Assistant"}),(0,l.jsx)("div",{className:"chat-controls",children:(0,l.jsxs)("div",{className:"chat-mode-selector",children:[(0,l.jsx)("label",{htmlFor:"chat-mode",children:"Mode:"}),(0,l.jsxs)("select",{id:"chat-mode",value:g,onChange:e=>{var s;(s=e.target.value)!==g&&m(s)},disabled:c||d?.includes("API is not configured"),children:[(0,l.jsx)("option",{value:"general",children:"General"}),(0,l.jsx)("option",{value:"selected-text-only",children:"Selected Text Only"})]})]})})]}),d&&d.includes("API is not configured")?(0,l.jsx)("div",{className:"api-config-error",style:{padding:"2rem",textAlign:"center",flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"Chat Service Not Available"}),(0,l.jsx)("p",{children:d}),(0,l.jsx)("p",{children:"Please contact the administrator to configure the backend API properly."})]})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"chat-messages",children:[o.map(e=>{return(0,l.jsxs)("div",{className:"message "+(s=e.sender_type,"user"===s?"user-message":"ai"===s?"ai-message":"system-message"),style:{alignSelf:"user"===e.sender_type?"flex-end":"flex-start",backgroundColor:"user"===e.sender_type?"#e3f2fd":"ai"===e.sender_type?"#f5f5f5":"#fff8e1",padding:"8px 12px",borderRadius:"8px",marginBottom:"8px",maxWidth:"80%"},children:[(0,l.jsx)("div",{className:"message-content",children:e.content}),(0,l.jsx)("div",{className:"message-timestamp",children:p(e.timestamp)})]},e.id);var s}),c&&(0,l.jsx)("div",{className:"loading-indicator",style:{alignSelf:"flex-start",padding:"8px"},children:"AI is thinking..."}),(0,l.jsx)("div",{ref:x})]}),d&&!d.includes("API is not configured")&&(0,l.jsx)("div",{className:"chat-error",style:{color:"red",padding:"8px",fontSize:"14px"},children:d}),(0,l.jsxs)("form",{className:"chat-input-form",onSubmit:async e=>{if(e.preventDefault(),h.trim()&&!c&&r)try{await a(r,h),u("")}catch(s){console.error("Error sending message:",s)}},children:[(0,l.jsx)("input",{type:"text",value:h,onChange:e=>u(e.target.value),placeholder:"selected-text-only"===g&&s?"Ask about the selected text...":"Ask about the textbook content...",disabled:c||!r||d?.includes("API is not configured"),style:{flex:1,padding:"10px",border:"1px solid #ccc",borderRadius:"4px",marginRight:"8px"}}),(0,l.jsx)("button",{type:"submit",disabled:c||!h.trim()||!r||d?.includes("API is not configured"),style:{padding:"10px 15px",backgroundColor:"#1976d2",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Send"})]})]})]})})},h=({userId:e,contentId:s,selectedText:t=null})=>{const{createChatSession:r,getChatSessions:o,getChatSessionMessages:a,sendChatMessage:i,loading:h,error:u}=c(),[g,m]=(0,n.useState)(null),[x,p]=(0,n.useState)([]),[f,y]=(0,n.useState)([]),[j,w]=(0,n.useState)("general"),[v,A]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e&&!v&&S()},[e,v]);const S=async()=>{const e=process.env.REACT_APP_API_BASE_URL;if(!e||e.includes("your-"))return setError("API is not configured properly. Please check your environment settings."),void A(!0);try{const e=await o({limit:10});if(p(e),e.length>0){const s=e[0];m(s),b(s.id)}else await I();A(!0)}catch(s){console.error("Error loading chat sessions:",s)}},I=async()=>{try{const e={selectedText:"selected-text-only"===j?t:null,mode:j},s=await r(e);m(s),p(e=>[s,...e]),y([])}catch(e){console.error("Error creating chat session:",e)}},b=async e=>{try{const s=await a(e);y(s)}catch(s){console.error(`Error loading messages for session ${e}:`,s)}},C=()=>{I()};return(0,l.jsxs)("div",{className:"chat-interface",children:[(0,l.jsxs)("div",{className:"chat-interface-header",children:[(0,l.jsx)("h2",{children:"AI Textbook Assistant"}),(0,l.jsx)("div",{className:"chat-controls",children:(0,l.jsxs)("div",{className:"chat-mode-selector",children:[(0,l.jsx)("label",{htmlFor:"chat-mode",children:"Mode:"}),(0,l.jsxs)("select",{id:"chat-mode",value:j,onChange:e=>{var s;(s=e.target.value)!==j&&(w(s),g&&I())},disabled:h||u?.includes("API is not configured"),children:[(0,l.jsx)("option",{value:"general",children:"General"}),(0,l.jsx)("option",{value:"selected-text-only",children:"Selected Text Only"})]})]})})]}),(0,l.jsxs)("div",{className:"chat-interface-body",children:[(0,l.jsx)("div",{className:"session-sidebar",children:x&&0!==x.length?(0,l.jsxs)("div",{className:"session-list",children:[(0,l.jsx)("h4",{children:"Previous Sessions"}),(0,l.jsx)("ul",{children:x.map(e=>(0,l.jsxs)("li",{className:"session-item "+((g&&g.id)===e.id?"active":""),onClick:()=>(e=>{m(e),b(e.id)})(e),children:[(0,l.jsxs)("div",{className:"session-title",children:["selected-text-only"===e.mode?"\ud83d\udd0d ":"\ud83d\udcac ",new Date(e.session_start).toLocaleDateString()]}),(0,l.jsxs)("div",{className:"session-meta",children:[e.mode," mode"]})]},e.id))}),(0,l.jsx)("button",{className:"new-session-btn",onClick:C,children:"+ New Session"})]}):(0,l.jsx)("div",{className:"no-sessions",children:"No chat sessions yet"})}),(0,l.jsx)("div",{className:"chat-main",children:u&&u.includes("API is not configured")?(0,l.jsxs)("div",{className:"api-config-error",style:{padding:"2rem",textAlign:"center"},children:[(0,l.jsx)("h3",{children:"Chat Service Not Available"}),(0,l.jsx)("p",{children:u}),(0,l.jsx)("p",{children:"Please contact the administrator to configure the backend API properly."})]}):g?(0,l.jsx)(d,{userId:e,selectedText:t,contentId:s,sessionId:g.id,messages:f,onSendMessage:async(e,s)=>{if(e&&s.trim())try{const t={id:`local-${Date.now()}`,sender_type:"user",content:s,timestamp:(new Date).toISOString()};y(e=>[...e,t]);const n=await i(e,s),r={id:`ai-${Date.now()}`,sender_type:"ai",content:n.response,timestamp:(new Date).toISOString()};y(e=>[...e,r])}catch(t){console.error("Error sending message:",t);const e={id:`error-${Date.now()}`,sender_type:"system",content:"Sorry, there was an error sending your message. Please try again.",timestamp:(new Date).toISOString()};y(s=>[...s,e])}},mode:g.mode,loading:h,error:u}):(0,l.jsxs)("div",{className:"no-session-active",children:[(0,l.jsx)("p",{children:"Select a session or create a new one to start chatting"}),(0,l.jsx)("button",{onClick:C,children:"Start New Chat"})]})})]})]})}}}]);