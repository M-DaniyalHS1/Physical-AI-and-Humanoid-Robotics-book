"use strict";(globalThis.webpackChunkai_textbook_frontend=globalThis.webpackChunkai_textbook_frontend||[]).push([[339],{6832(e,s,t){t.r(s),t.d(s,{default:()=>c});var n=t(6540),i=t(1258),a=t(6347),r=t(9184),o=t(4848);const l=()=>{const[e,s]=(0,n.useState)(!1),[t,i]=(0,n.useState)(!1),l=(0,a.zy)();return(0,n.useEffect)(()=>{i(!0)},[]),(0,n.useEffect)(()=>{"/chat"===l.pathname&&s(!1)},[l.pathname]),t?(0,o.jsx)("div",{className:"floating-chat-widget",children:e?(0,o.jsxs)("div",{className:"floating-chat-container",style:{position:"fixed",bottom:"20px",right:"20px",width:"400px",height:"600px",maxHeight:"80vh",backgroundColor:"white",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0,0,0,0.2)",zIndex:1e3,display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,o.jsxs)("div",{className:"floating-chat-header",style:{backgroundColor:"#1976d2",color:"white",padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,o.jsx)("h3",{style:{margin:0,fontSize:"16px"},children:"AI Textbook Assistant"}),(0,o.jsx)("button",{onClick:()=>s(!1),style:{background:"none",border:"none",color:"white",fontSize:"20px",cursor:"pointer",padding:"0",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"Close chat",children:"\xd7"})]}),(0,o.jsx)("div",{style:{flex:1,overflow:"auto"},children:(0,o.jsx)(r.A,{userId:"undefined"!=typeof window&&localStorage.getItem("userId")||"demo-user",style:{height:"100%"}})})]}):(0,o.jsx)("button",{className:"floating-chat-button",onClick:()=>s(!0),"aria-label":"Open AI Assistant",style:{position:"fixed",bottom:"20px",right:"20px",width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"#1976d2",color:"white",border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",cursor:"pointer",zIndex:1e3,fontSize:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:"\ud83d\udcac"})}):(0,o.jsx)("div",{className:"floating-chat-toggle",children:(0,o.jsx)("button",{className:"floating-chat-button",onClick:()=>{},"aria-label":"Open AI Assistant",style:{position:"fixed",bottom:"20px",right:"20px",width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"#1976d2",color:"white",border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",cursor:"pointer",zIndex:1e3,fontSize:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:"\ud83d\udcac"})})};function c(e){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.A,{...e}),(0,o.jsx)(l,{})]})}},9184(e,s,t){t.d(s,{A:()=>o});var n=t(6540),i=t(1256),a=t(4848);const r=({userId:e,selectedText:s=null,contentId:t=null,sessionId:i,messages:r=[],onSendMessage:o,mode:l="general",loading:c=!1,error:d=null})=>{const[h,x]=(0,n.useState)(""),[u,g]=(0,n.useState)(l),m=(0,n.useRef)(null);(0,n.useEffect)(()=>{m.current&&m.current.scrollIntoView({behavior:"smooth"})},[r]);const p=e=>{if(!e)return"";return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return(0,a.jsx)("div",{className:"chat-widget",children:(0,a.jsxs)("div",{className:"chat-window",children:[(0,a.jsxs)("div",{className:"chat-header",children:[(0,a.jsx)("h3",{children:"AI Textbook Assistant"}),(0,a.jsx)("div",{className:"chat-controls",children:(0,a.jsxs)("div",{className:"chat-mode-selector",children:[(0,a.jsx)("label",{htmlFor:"chat-mode",children:"Mode:"}),(0,a.jsxs)("select",{id:"chat-mode",value:u,onChange:e=>{var s;(s=e.target.value)!==u&&g(s)},disabled:c||d?.includes("API is not configured"),children:[(0,a.jsx)("option",{value:"general",children:"General"}),(0,a.jsx)("option",{value:"selected-text-only",children:"Selected Text Only"})]})]})})]}),d&&d.includes("API is not configured")?(0,a.jsx)("div",{className:"api-config-error",style:{padding:"2rem",textAlign:"center",flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{children:"Chat Service Not Available"}),(0,a.jsx)("p",{children:d}),(0,a.jsx)("p",{children:"Please contact the administrator to configure the backend API properly."})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"chat-messages",children:[r.map(e=>{return(0,a.jsxs)("div",{className:"message "+(s=e.sender_type,"user"===s?"user-message":"ai"===s?"ai-message":"system-message"),style:{alignSelf:"user"===e.sender_type?"flex-end":"flex-start",backgroundColor:"user"===e.sender_type?"#e3f2fd":"ai"===e.sender_type?"#f5f5f5":"#fff8e1",padding:"8px 12px",borderRadius:"8px",marginBottom:"8px",maxWidth:"80%"},children:[(0,a.jsx)("div",{className:"message-content",children:e.content}),(0,a.jsx)("div",{className:"message-timestamp",children:p(e.timestamp)})]},e.id);var s}),c&&(0,a.jsx)("div",{className:"loading-indicator",style:{alignSelf:"flex-start",padding:"8px"},children:"AI is thinking..."}),(0,a.jsx)("div",{ref:m})]}),d&&!d.includes("API is not configured")&&(0,a.jsx)("div",{className:"chat-error",style:{color:"red",padding:"8px",fontSize:"14px"},children:d}),(0,a.jsxs)("form",{className:"chat-input-form",onSubmit:async e=>{if(e.preventDefault(),h.trim()&&!c&&i)try{await o(i,h),x("")}catch(s){console.error("Error sending message:",s)}},children:[(0,a.jsx)("input",{type:"text",value:h,onChange:e=>x(e.target.value),placeholder:"selected-text-only"===u&&s?"Ask about the selected text...":"Ask about the textbook content...",disabled:c||!i||d?.includes("API is not configured"),style:{flex:1,padding:"10px",border:"1px solid #ccc",borderRadius:"4px",marginRight:"8px"}}),(0,a.jsx)("button",{type:"submit",disabled:c||!h.trim()||!i||d?.includes("API is not configured"),style:{padding:"10px 15px",backgroundColor:"#1976d2",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Send"})]})]})]})})},o=({userId:e,contentId:s,selectedText:t=null})=>{const{createChatSession:o,getChatSessions:l,getChatSessionMessages:c,sendChatMessage:d,loading:h,error:x}=(0,i.V)(),[u,g]=(0,n.useState)(null),[m,p]=(0,n.useState)([]),[f,j]=(0,n.useState)([]),[b,y]=(0,n.useState)("general"),[v,S]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e&&!v&&w()},[e,v]);const w=async()=>{const e=process.env.REACT_APP_API_BASE_URL;if(!e||e.includes("your-"))return setError("API is not configured properly. Please check your environment settings."),void S(!0);try{const e=await l({limit:10});if(p(e),e.length>0){const s=e[0];g(s),N(s.id)}else await I();S(!0)}catch(s){console.error("Error loading chat sessions:",s)}},I=async()=>{try{const e={selectedText:"selected-text-only"===b?t:null,mode:b},s=await o(e);g(s),p(e=>[s,...e]),j([])}catch(e){console.error("Error creating chat session:",e)}},N=async e=>{try{const s=await c(e);j(s)}catch(s){console.error(`Error loading messages for session ${e}:`,s)}},A=()=>{I()};return(0,a.jsxs)("div",{className:"chat-interface",children:[(0,a.jsxs)("div",{className:"chat-interface-header",children:[(0,a.jsx)("h2",{children:"AI Textbook Assistant"}),(0,a.jsx)("div",{className:"chat-controls",children:(0,a.jsxs)("div",{className:"chat-mode-selector",children:[(0,a.jsx)("label",{htmlFor:"chat-mode",children:"Mode:"}),(0,a.jsxs)("select",{id:"chat-mode",value:b,onChange:e=>{var s;(s=e.target.value)!==b&&(y(s),u&&I())},disabled:h||x?.includes("API is not configured"),children:[(0,a.jsx)("option",{value:"general",children:"General"}),(0,a.jsx)("option",{value:"selected-text-only",children:"Selected Text Only"})]})]})})]}),(0,a.jsxs)("div",{className:"chat-interface-body",children:[(0,a.jsx)("div",{className:"session-sidebar",children:m&&0!==m.length?(0,a.jsxs)("div",{className:"session-list",children:[(0,a.jsx)("h4",{children:"Previous Sessions"}),(0,a.jsx)("ul",{children:m.map(e=>(0,a.jsxs)("li",{className:"session-item "+((u&&u.id)===e.id?"active":""),onClick:()=>(e=>{g(e),N(e.id)})(e),children:[(0,a.jsxs)("div",{className:"session-title",children:["selected-text-only"===e.mode?"\ud83d\udd0d ":"\ud83d\udcac ",new Date(e.session_start).toLocaleDateString()]}),(0,a.jsxs)("div",{className:"session-meta",children:[e.mode," mode"]})]},e.id))}),(0,a.jsx)("button",{className:"new-session-btn",onClick:A,children:"+ New Session"})]}):(0,a.jsx)("div",{className:"no-sessions",children:"No chat sessions yet"})}),(0,a.jsx)("div",{className:"chat-main",children:x&&x.includes("API is not configured")?(0,a.jsxs)("div",{className:"api-config-error",style:{padding:"2rem",textAlign:"center"},children:[(0,a.jsx)("h3",{children:"Chat Service Not Available"}),(0,a.jsx)("p",{children:x}),(0,a.jsx)("p",{children:"Please contact the administrator to configure the backend API properly."})]}):u?(0,a.jsx)(r,{userId:e,selectedText:t,contentId:s,sessionId:u.id,messages:f,onSendMessage:async(e,s)=>{if(e&&s.trim())try{const t={id:`local-${Date.now()}`,sender_type:"user",content:s,timestamp:(new Date).toISOString()};j(e=>[...e,t]);const n=await d(e,s),i={id:`ai-${Date.now()}`,sender_type:"ai",content:n.response,timestamp:(new Date).toISOString()};j(e=>[...e,i])}catch(t){console.error("Error sending message:",t);const e={id:`error-${Date.now()}`,sender_type:"system",content:"Sorry, there was an error sending your message. Please try again.",timestamp:(new Date).toISOString()};j(s=>[...s,e])}},mode:u.mode,loading:h,error:x}):(0,a.jsxs)("div",{className:"no-session-active",children:[(0,a.jsx)("p",{children:"Select a session or create a new one to start chatting"}),(0,a.jsx)("button",{onClick:A,children:"Start New Chat"})]})})]})]})}}}]);